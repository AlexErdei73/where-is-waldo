(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};let t;e.d({},{nC:()=>l,Tx:()=>v,BH:()=>a,QO:()=>y,eR:()=>x,tM:()=>p,HZ:()=>g});const o=storage.ref();function n(){o.child(["pictures/waldo-1.jpg","pictures/waldo-2.jpg","pictures/waldo-3.jpg"][p]).getDownloadURL().then((e=>{a.src=e,a.onload=()=>{a.classList.add("show"),a.removeAttribute("onload")},db.collection("games").add({clicks:[],pictureIndex:p}).then((e=>{console.log("Document written with ID: ",e.id),t=e.id,db.collection("secureGameData").doc(t).onSnapshot((e=>{const t=e.data();if(!t)return;const o=t.target;if(o)if(t.hit)(function(e,t){const o=document.querySelector(".picture-container");if(-1!==Array.from(document.querySelectorAll(".tag")).map((e=>e.getAttribute("target"))).indexOf(t))return;const n=document.createElement("div");n.setAttribute("target",t),n.textContent=t,n.classList.add("tag"),function(e,t){return function(e,t){return db.collection("secureGameData").doc("pictureInfo").get().then((o=>o.data().positions[e][t]))}(e,t).then((e=>{return t=e,{x:Math.round((t.xmin+t.xmax)/2),y:Math.round((t.ymin+t.ymax)/2)};var t}))}(e,t).then((e=>{n.style.top=`${e.y}px`,n.style.left=`${e.x}px`,o.appendChild(n)}))})(p,o),v(t);else{const e=t.click;!function(e){const t=document.querySelector(".picture-container"),o=document.createElement("div");o.textContent="You missed it!",o.classList.add("tag"),o.style.top=`${e.y}px`,o.style.left=`${e.x}px`,o.style.background="red",t.appendChild(o),setTimeout((()=>{o.remove()}),1500)}({x:e.x,y:e.y})}}))})).catch((e=>{console.error("Error adding document: ",e)}))}))}const c=document.querySelectorAll(".choice");function r(){db.collection("secureGameData").doc("pictureInfo").get().then((e=>e.data().numbersOfCharacters[p])).then((e=>{c.forEach(((t,o)=>{t.addEventListener("click",x),o>=e&&(t.setAttribute("disabled",!0),t.style.opacity=0,4===e&&(t.style.heigth="16px"))}))}))}const l=document.querySelector(".picture-container"),a=document.querySelector("#game-hero"),s=document.querySelector(".popup-menu"),d=document.querySelector("#start");let i=!1,u=!1;const m={x:0,y:0,target:""};let p=0;const y=3;l.style.marginTop="60px",function(){const e=document.createElement("p");e.textContent="Let me itroduce you Waldo and his friends:",e.style.fontSize="21px",e.style.width="600px",e.style.margin="20px auto",l.appendChild(e);const t=["assets/waldo.jpg","assets/odlaw.jpg","assets/wizzard.jpeg","assets/wenda.jpeg"],o=["waldo","odlaw","wizzard","wenda"];let n;const c=document.createElement("div");c.style.width="400px",c.style.margin="auto",c.id="characters",l.appendChild(c);for(let e=0;e<4;e++)n=document.createElement("img"),n.src=t[e],n.style.width="50px",n.style.opacity=1,n.style.margin="20px",c.appendChild(n);const r=document.createElement("div");c.appendChild(r);for(let e=0;e<4;e++){const t=document.createElement("div");t.textContent=o[e],t.style.width="50px",t.style.display="inline",t.style.margin="20px",c.appendChild(t)}const a=document.createElement("p");a.textContent="Your task is finding them on the pictures by \n    clicking the right place on the picture. The program measures your\n    time, the faster you can find them, the better. Are you ready? \n    Press the button!",a.style.fontSize="21px",a.style.width="600px",a.style.margin="20px auto",l.appendChild(a)}();const h=document.querySelector("#next"),f=document.querySelector("#scores");let g=!1;function x(e){const o=e.target;console.log(o.textContent),m.target=o.textContent,s.classList.remove("show"),i=!1,function(e){db.collection("games").doc(t).update({clicks:firebase.firestore.FieldValue.arrayUnion(e)}).then((()=>{console.log("Document has been updated with ID: ",t)})).catch((e=>{console.error("Error updating document: ",e)}))}(m)}function b(){document.querySelector(".modal").style.visibility="hidden",document.querySelector(".modal-content").classList.replace("show-modal","hide-modal");const e=document.querySelector("#name").value;var o;o=e,db.collection("games").doc(t).update({username:o}).then((()=>{console.log(`Username: ${o} has been added to Document with ID: `,t)})).catch((e=>{console.error("Error updating document: ",e)})),a.classList.remove("show"),u=!1,i=!1,document.querySelectorAll(".tag").forEach((e=>e.remove()))}function v(e){if(!e.isGameOver)return;const t=e.time;var o;t&&(o=`You have found everybody in ${t}s`,document.querySelector(".modal-body").querySelector("p").textContent=o,function(){const e=document.querySelector("#name");0===p?e.removeAttribute("readonly"):e.setAttribute("readonly",!0)}(),document.querySelector(".modal").style.visibility="visible",document.querySelector(".modal-content").classList.replace("hide-modal","show-modal"),u=!0)}a.addEventListener("click",(function(e){if(i||u)return;const t=e.layerX,o=e.layerY;console.log({x:t,y:o}),m.x=t,m.y=o,s.classList.add("show"),s.style.top=o-30+"px",s.style.left=t-15+"px",i=!0})),d.addEventListener("click",(function(){d.style.visibility="hidden",l.querySelectorAll("p").forEach((e=>e.remove())),l.querySelector("#characters").remove(),n()})),h.addEventListener("click",(function(){b(),p===y-1?g=!0:(p++,n(),c.forEach((e=>{e.removeEventListener("click",x),e.removeAttribute("disabled"),e.style=""})),r())})),f.addEventListener("click",(function(){console.log("Scores clicked!"),b(),g=!0})),r(),db.collection("secureGameData").doc("scores").onSnapshot((e=>{const t=e.data(),o=[],n=[];for(let e=0;e<y;e++)n.push(t[e].length),o.push(t[e]);!function(e,t){if(!g)return;a.classList.remove("show"),a.style.position="absolute";const o=document.createElement("table");let n,c=document.createElement("tr");for(let e=0;e<y;e++)n=document.createElement("th"),n.textContent=`Picture-${e}`,n.setAttribute("colspan","2"),c.appendChild(n);o.appendChild(c);const r=t.reduce(((e,t)=>e>t?e:t));let s,d;for(let n=0;n<r;n++){c=document.createElement("tr");for(let o=0;o<y;o++)d=document.createElement("td"),n<t[o]?(s=e[o][n],d.textContent=s.username,c.appendChild(d),d=document.createElement("td"),d.textContent=s.time+"s"):d.setAttribute("colspan","2"),c.appendChild(d);o.appendChild(c)}l.appendChild(o)}(o,n)}))})();