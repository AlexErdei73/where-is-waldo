(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};let t;e.d({},{ln:()=>f,Tx:()=>g,tM:()=>u});const o=document.querySelector(".picture-container"),n=document.querySelector("#game-hero"),r=document.querySelector(".popup-menu"),c=document.querySelectorAll(".choice"),a=document.querySelector("#start");let l=!1,s=!1;const d={x:0,y:0,target:""},i=storage.ref();let u=0;o.style.marginTop="60px",function(){const e=document.createElement("p");e.textContent="Let me itroduce you Waldo and his friends:",e.style.fontSize="21px",e.style.width="600px",e.style.margin="20px auto",o.appendChild(e);const t=["assets/waldo.jpg","assets/odlaw.jpg","assets/wizzard.jpeg","assets/wenda.jpeg"],n=["waldo","odlaw","wizzard","wenda"];let r;const c=document.createElement("div");c.style.width="400px",c.style.margin="auto",c.id="characters",o.appendChild(c);for(let e=0;e<4;e++)r=document.createElement("img"),r.src=t[e],r.style.width="50px",r.style.opacity=1,r.style.margin="20px",c.appendChild(r);const a=document.createElement("div");c.appendChild(a);for(let e=0;e<4;e++){const t=document.createElement("div");t.textContent=n[e],t.style.width="50px",t.style.display="inline",t.style.margin="20px",c.appendChild(t)}const l=document.createElement("p");l.textContent="Your task is finding them on the pictures by \n  clicking the right place on the picture. The program measures your\n  time, the faster you can find them, the better. Are you ready? \n  Press the button!",l.style.fontSize="21px",l.style.width="600px",l.style.margin="20px auto",o.appendChild(l)}();const m=document.querySelector("#next");let p=!1;function h(e){const o=e.target;console.log(o.textContent),d.target=o.textContent,r.classList.remove("show"),l=!1,function(e){db.collection("games").doc(t).update({clicks:firebase.firestore.FieldValue.arrayUnion(e)}).then((()=>{console.log("Document has been updated with ID: ",t)})).catch((e=>{console.error("Error updating document: ",e)}))}(d)}function y(){i.child(["pictures/waldo-1.jpg","pictures/waldo-2.jpg"][u]).getDownloadURL().then((e=>{n.src=e,n.classList.add("show"),db.collection("games").add({clicks:[],pictureIndex:u}).then((e=>{console.log("Document written with ID: ",e.id),t=e.id,db.collection("secureGameData").doc(t).onSnapshot((e=>{const t=e.data();if(!t)return;const o=t.target;o&&(t.hit?(f(o),g(t)):console.log(`${o} was missed`))}))})).catch((e=>{console.error("Error adding document: ",e)}))}))}function f(e){const t=document.querySelector(".picture-container");if(-1!==Array.from(document.querySelectorAll(".tag")).map((e=>e.getAttribute("target"))).indexOf(e))return;const o=document.createElement("div");o.setAttribute("target",e),o.textContent=e,o.classList.add("tag"),function(e,t){return db.collection("secureGameData").doc("pictureInfo").get().then((o=>{const n=o.data().positions[e][t];return{x:Math.round((n.xmin+n.xmax)/2),y:Math.round((n.ymin+n.ymax)/2)}}))}(u,e).then((e=>{o.style.top=`${e.y}px`,o.style.left=`${e.x}px`,t.appendChild(o)}))}function g(e){if(!e.isGameOver)return;const t=e.time;var o;t&&(o=`You have found everybody in ${t}s`,document.querySelector(".modal-body").querySelector("p").textContent=o,function(){const e=document.querySelector("#name");0===u?e.removeAttribute("readonly"):e.setAttribute("readonly",!0)}(),document.querySelector(".modal").style.visibility="visible",document.querySelector(".modal-content").classList.replace("hide-modal","show-modal"),s=!0)}function x(){db.collection("secureGameData").doc("pictureInfo").get().then((e=>{const t=e.data().numbersOfCharacters[u];c.forEach(((e,o)=>{e.addEventListener("click",h),o>=t&&(e.setAttribute("disabled",!0),e.style.opacity=0,4===t&&(e.style.heigth="16px"))}))}))}n.addEventListener("click",(function(e){if(l||s)return;const t=e.layerX,o=e.layerY;console.log({x:t,y:o}),d.x=t,d.y=o,r.classList.add("show"),r.style.top=o-30+"px",r.style.left=t-15+"px",l=!0})),a.addEventListener("click",(function(){a.style.visibility="hidden",o.querySelectorAll("p").forEach((e=>e.remove())),o.querySelector("#characters").remove(),y()})),m.addEventListener("click",(function(){var e;document.querySelector(".modal").style.visibility="hidden",document.querySelector(".modal-content").classList.replace("show-modal","hide-modal"),e=document.querySelector("#name").value,db.collection("games").doc(t).update({username:e}).then((()=>{console.log(`Username: ${e} has been added to Document with ID: `,t)})).catch((e=>{console.error("Error updating document: ",e)})),n.classList.remove("show"),s=!1,l=!1,document.querySelector(".picture-container"),document.querySelectorAll(".tag").forEach((e=>e.remove())),1===u?p=!0:(u++,y(),c.forEach((e=>{e.removeEventListener("click",h),e.removeAttribute("disabled"),e.style=""})),x())})),x(),db.collection("secureGameData").doc("scores").onSnapshot((e=>{const t=e.data(),r=[],c=[];for(let e=0;e<2;e++)c.push(t[e].length),r.push(t[e]);!function(e,t){if(!p)return;n.classList.remove("show"),n.style.position="absolute";const r=document.createElement("table");let c,a=document.createElement("tr");for(let e=0;e<2;e++)c=document.createElement("th"),c.textContent=`Picture-${e}`,c.setAttribute("colspan","2"),a.appendChild(c);r.appendChild(a);const l=t.reduce(((e,t)=>e>t?e:t));let s,d;for(let o=0;o<l;o++){a=document.createElement("tr");for(let n=0;n<2;n++)d=document.createElement("td"),o<t[n]?(s=e[n][o],d.textContent=s.username,a.appendChild(d),d=document.createElement("td"),d.textContent=s.time+"s"):d.setAttribute("colspan","2"),a.appendChild(d);r.appendChild(a)}o.appendChild(r)}(r,c)}))})();