(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};let t;e.d({},{nC:()=>a,Tx:()=>v,BH:()=>l,QO:()=>s,eR:()=>x,tM:()=>i,HZ:()=>d});const n=storage.ref();function o(){n.child(["pictures/waldo-1.jpg","pictures/waldo-2.jpg","pictures/waldo-3.jpg"][i]).getDownloadURL().then((e=>{l.src=e,l.onload=()=>{l.classList.add("show"),l.removeAttribute("onload")},db.collection("games").add({clicks:[],pictureIndex:i}).then((e=>{t=e.id,db.collection("secureGameData").doc(t).onSnapshot((e=>{const t=e.data();if(!t)return;const n=t.target;if(n)if(t.hit)(function(e,t){const n=document.querySelector(".picture-container");if(-1!==Array.from(document.querySelectorAll(".tag")).map((e=>e.getAttribute("target"))).indexOf(t))return;const o=document.createElement("div");o.setAttribute("target",t),o.textContent=t,o.classList.add("tag"),function(e,t){return function(e,t){return db.collection("secureGameData").doc("pictureInfo").get().then((n=>n.data().positions[e][t]))}(e,t).then((e=>{return t=e,{x:Math.round((t.xmin+t.xmax)/2),y:Math.round((t.ymin+t.ymax)/2)};var t}))}(e,t).then((e=>{o.style.top=`${e.y}px`,o.style.left=`${e.x}px`,n.appendChild(o)}))})(i,n),v(t);else{const e=t.click;!function(e){const t=document.querySelector(".picture-container"),n=document.createElement("div");n.textContent="You missed it!",n.classList.add("tag"),n.style.top=`${e.y}px`,n.style.left=`${e.x}px`,n.style.background="red",t.appendChild(n),setTimeout((()=>{n.remove()}),1500)}({x:e.x,y:e.y})}}))})).catch((e=>{console.error("Error adding document: ",e)}))}))}const r=document.querySelectorAll(".choice");function c(){db.collection("secureGameData").doc("pictureInfo").get().then((e=>e.data().numbersOfCharacters[i])).then((e=>{r.forEach(((t,n)=>{t.addEventListener("click",x),n>=e&&(t.setAttribute("disabled",!0),t.style.opacity=0,4===e&&(t.style.heigth="16px"))}))}))}const a=document.querySelector(".picture-container"),l=document.querySelector("#game-hero");let i=0;const s=3;let d=!1;const u=document.querySelector(".popup-menu"),m=document.querySelector("#start");let p=!1,y=!1;const h={x:0,y:0,target:""};a.style.marginTop="60px",function(){const e=document.createElement("p");e.textContent="Let me itroduce you Waldo and his friends:",e.style.fontSize="21px",e.style.width="600px",e.style.margin="20px auto",a.appendChild(e);const t=["assets/waldo.jpg","assets/odlaw.jpg","assets/wizzard.jpeg","assets/wenda.jpeg"],n=["waldo","odlaw","wizzard","wenda"];let o;const r=document.createElement("div");r.style.width="400px",r.style.margin="auto",r.id="characters",a.appendChild(r);for(let e=0;e<4;e++)o=document.createElement("img"),o.src=t[e],o.style.width="50px",o.style.opacity=1,o.style.margin="20px",r.appendChild(o);const c=document.createElement("div");r.appendChild(c);for(let e=0;e<4;e++){const t=document.createElement("div");t.textContent=n[e],t.style.width="50px",t.style.display="inline",t.style.margin="20px",r.appendChild(t)}const l=document.createElement("p");l.textContent="Your task is finding them on the pictures by \n    clicking the right place on the picture. The program measures your\n    time, the faster you can find them, the better. Are you ready? \n    Press the button!",l.style.fontSize="21px",l.style.width="600px",l.style.margin="20px auto",a.appendChild(l)}();const f=document.querySelector("#next"),g=document.querySelector("#scores");function x(e){const n=e.target;h.target=n.textContent,u.classList.remove("show"),p=!1,function(e){db.collection("games").doc(t).update({clicks:firebase.firestore.FieldValue.arrayUnion(e)}).catch((e=>{console.error("Error updating document: ",e)}))}(h)}function b(){document.querySelector(".modal").style.visibility="hidden",document.querySelector(".modal-content").classList.replace("show-modal","hide-modal");var e;e=document.querySelector("#name").value,db.collection("games").doc(t).update({username:e}).catch((e=>{console.error("Error updating document: ",e)})),l.classList.remove("show"),y=!1,p=!1,document.querySelectorAll(".tag").forEach((e=>e.remove()))}function v(e){if(!e.isGameOver)return;const t=e.time;var n;t&&(n=`You have found everybody in ${t}s`,document.querySelector(".modal-body").querySelector("p").textContent=n,function(){const e=document.querySelector("#name");0===i?e.removeAttribute("readonly"):e.setAttribute("readonly",!0)}(),document.querySelector(".modal").style.visibility="visible",document.querySelector(".modal-content").classList.replace("hide-modal","show-modal"),y=!0)}l.addEventListener("click",(function(e){if(p||y)return;const t=e.layerX,n=e.layerY;h.x=t,h.y=n,u.classList.add("show"),u.style.top=n-30+"px",u.style.left=t-15+"px",p=!0})),m.addEventListener("click",(function(){m.style.visibility="hidden",a.querySelectorAll("p").forEach((e=>e.remove())),a.querySelector("#characters").remove(),o()})),f.addEventListener("click",(function(){b(),i===s-1?d=!0:(i++,o(),r.forEach((e=>{e.removeEventListener("click",x),e.removeAttribute("disabled"),e.style=""})),c())})),g.addEventListener("click",(function(){b(),d=!0})),c(),db.collection("secureGameData").doc("scores").onSnapshot((e=>{const t=e.data(),n=[],o=[];for(let e=0;e<s;e++)o.push(t[e].length),n.push(t[e]);!function(e,t){if(!d)return;l.classList.remove("show"),l.style.position="absolute";const n=document.createElement("table");let o,r=document.createElement("tr");for(let e=0;e<s;e++)o=document.createElement("th"),o.textContent=`Picture-${e}`,o.setAttribute("colspan","2"),r.appendChild(o);n.appendChild(r);const c=t.reduce(((e,t)=>e>t?e:t));let i,u;for(let o=0;o<c;o++){r=document.createElement("tr");for(let n=0;n<s;n++)u=document.createElement("td"),o<t[n]?(i=e[n][o],u.textContent=i.username,r.appendChild(u),u=document.createElement("td"),u.textContent=i.time+"s"):u.setAttribute("colspan","2"),r.appendChild(u);n.appendChild(r)}a.appendChild(n)}(n,o)}))})();