(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n){const o=document.createElement("div");if(""!==e){if(-1!==Array.from(document.querySelectorAll(".tag")).map((e=>e.getAttribute("target"))).indexOf(e))return;o.setAttribute("target",e),o.textContent=e}else o.textContent=t,o.classList.add("tag"),o.style.top=`${n.y}px`,o.style.left=`${n.x}px`,o.style.background="red";return o.classList.add("tag"),o}let n;e.d({},{nC:()=>l,Tx:()=>C,BH:()=>i,QO:()=>d,eR:()=>b,tM:()=>s,HZ:()=>u});const o=storage.ref();function r(){o.child(["pictures/waldo-1.jpg","pictures/waldo-2.jpg","pictures/waldo-3.jpg"][s]).getDownloadURL().then((e=>{i.src=e,i.onload=()=>{i.classList.add("show"),i.removeAttribute("onload")},db.collection("games").add({clicks:[],pictureIndex:s}).then((e=>{n=e.id,db.collection("secureGameData").doc(n).onSnapshot((e=>{const n=e.data();if(!n)return;const o=n.target;if(o)if(n.hit)(function(e,n){const o=document.querySelector(".picture-container"),r=t(n,n);r&&function(e,t){return function(e,t){return db.collection("secureGameData").doc("pictureInfo").get().then((n=>n.data().positions[e][t]))}(e,t).then((e=>{return t=e,{x:Math.round((t.xmin+t.xmax)/2),y:Math.round((t.ymin+t.ymax)/2)};var t}))}(e,n).then((e=>{r.style.top=`${e.y}px`,r.style.left=`${e.x}px`,o.appendChild(r)}))})(s,o),C(n);else{const e=n.click;!function(e){const n=document.querySelector(".picture-container"),o=t("","You missed it!",e);n.appendChild(o),setTimeout((()=>{o.remove()}),1500)}({x:e.x,y:e.y})}}))})).catch((e=>{console.error("Error adding document: ",e)}))}))}const c=document.querySelectorAll(".choice");function a(){db.collection("secureGameData").doc("pictureInfo").get().then((e=>e.data().numbersOfCharacters[s])).then((e=>{c.forEach(((t,n)=>{t.addEventListener("click",b),n>=e&&(t.setAttribute("disabled",!0),t.style.opacity=0),4===e&&(t.style.height="16px")}))}))}const l=document.querySelector(".picture-container"),i=document.querySelector("#game-hero");let s=0;const d=3;let u=!1;const m=document.querySelector(".popup-menu"),p=document.querySelector("#start");let y=!1,h=!1;const f={x:0,y:0,target:""};l.style.marginTop="60px",function(){const e=document.createElement("p");e.textContent="Let me itroduce you Waldo and his friends:",e.style.fontSize="21px",e.style.width="600px",e.style.margin="20px auto",l.appendChild(e);const t=["assets/waldo.jpg","assets/odlaw.jpg","assets/wizzard.jpeg","assets/wenda.jpeg"],n=["waldo","odlaw","wizzard","wenda"];let o;const r=document.createElement("div");r.style.width="400px",r.style.margin="auto",r.id="characters",l.appendChild(r);for(let e=0;e<4;e++)o=document.createElement("img"),o.src=t[e],o.style.width="50px",o.style.opacity=1,o.style.margin="20px",r.appendChild(o);const c=document.createElement("div");r.appendChild(c);for(let e=0;e<4;e++){const t=document.createElement("div");t.textContent=n[e],t.style.width="50px",t.style.display="inline",t.style.margin="20px",r.appendChild(t)}const a=document.createElement("p");a.textContent="Your task is finding them on the pictures by \n    clicking the right place on the picture. The program measures your\n    time, the faster you can find them, the better. Are you ready? \n    Press the button!",a.style.fontSize="21px",a.style.width="600px",a.style.margin="20px auto",l.appendChild(a)}();const g=document.querySelector("#next"),x=document.querySelector("#scores");function b(e){const t=e.target;f.target=t.textContent,m.classList.remove("show"),y=!1,function(e){db.collection("games").doc(n).update({clicks:firebase.firestore.FieldValue.arrayUnion(e)}).catch((e=>{console.error("Error updating document: ",e)}))}(f)}function v(){document.querySelector(".modal").style.visibility="hidden",document.querySelector(".modal-content").classList.replace("show-modal","hide-modal");var e;e=document.querySelector("#name").value,db.collection("games").doc(n).update({username:e}).catch((e=>{console.error("Error updating document: ",e)})),i.classList.remove("show"),h=!1,y=!1,document.querySelectorAll(".tag").forEach((e=>e.remove()))}function C(e){if(!e.isGameOver)return;const t=e.time;var n;t&&(n=`You have found everybody in ${t}s`,document.querySelector(".modal-body").querySelector("p").textContent=n,function(){const e=document.querySelector("#name");0===s?e.removeAttribute("readonly"):e.setAttribute("readonly",!0)}(),document.querySelector(".modal").style.visibility="visible",document.querySelector(".modal-content").classList.replace("hide-modal","show-modal"),h=!0)}i.addEventListener("click",(function(e){if(y||h)return;const t=e.layerX,n=e.layerY;f.x=t,f.y=n,m.classList.add("show"),m.style.top=n-30+"px",m.style.left=t-15+"px",y=!0})),p.addEventListener("click",(function(){p.style.visibility="hidden",l.querySelectorAll("p").forEach((e=>e.remove())),l.querySelector("#characters").remove(),r()})),g.addEventListener("click",(function(){v(),s===d-1?u=!0:(s++,r(),c.forEach((e=>{e.removeEventListener("click",b),e.removeAttribute("disabled"),e.style=""})),a())})),x.addEventListener("click",(function(){v(),u=!0})),a(),db.collection("secureGameData").doc("scores").onSnapshot((e=>{const t=e.data(),n=[],o=[];for(let e=0;e<d;e++)o.push(t[e].length),n.push(t[e]);!function(e,t){if(!u)return;i.classList.remove("show"),i.style.position="absolute";const n=document.createElement("table");let o,r=document.createElement("tr");for(let e=0;e<d;e++)o=document.createElement("th"),o.textContent=`Picture-${e}`,o.setAttribute("colspan","2"),r.appendChild(o);n.appendChild(r);const c=t.reduce(((e,t)=>e>t?e:t));let a,s;for(let o=0;o<c;o++){r=document.createElement("tr");for(let n=0;n<d;n++)s=document.createElement("td"),o<t[n]?(a=e[n][o],s.textContent=a.username,r.appendChild(s),s=document.createElement("td"),s.textContent=a.time+"s"):s.setAttribute("colspan","2"),r.appendChild(s);n.appendChild(r)}l.appendChild(n)}(n,o)}))})();